(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-1364d535"],{"8c6e":function(e,t,i){"use strict";i.r(t);var n=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("van-uploader",{attrs:{"after-read":e.afterRead}})],1)},a=[],s=i("2b0e"),o=i("8f80");s["default"].use(o["a"]);var r={name:"",data:function(){return{}},methods:{afterRead:function(e){console.log(e.content)}}},l=r,c=i("2877"),h=Object(c["a"])(l,n,a,!1,null,null,null);t["default"]=h.exports},"8f80":function(e,t,i){"use strict";var n=i("c31d"),a=i("d282"),s=i("ea8e"),o=i("a142");function r(e){return Array.isArray(e)?e:[e]}function l(e,t){return new Promise((function(i){if("file"!==t){var n=new FileReader;n.onload=function(e){i(e.target.result)},"dataUrl"===t?n.readAsDataURL(e):"text"===t&&n.readAsText(e)}else i()}))}function c(e,t){return r(e).some((function(e){return e.size>t}))}var h=/\.(jpeg|jpg|gif|png|svg|webp|jfif|bmp|dpg)/i;function u(e){return h.test(e)}function f(e){return!!e.isImage||(e.file&&e.file.type?0===e.file.type.indexOf("image"):e.url?u(e.url):!!e.content&&0===e.content.indexOf("data:image"))}var d=i("ad06"),m=i("44bf"),v=i("2b0e"),p=i("482d"),g=i("1325"),w=i("6605"),b=i("3875"),y=i("543e"),x=i("5596"),S=i("2bb1"),I=Object(a["a"])("image-preview"),T=I[0],C=I[1];function M(e){return Math.sqrt(Math.pow(e[0].clientX-e[1].clientX,2)+Math.pow(e[0].clientY-e[1].clientY,2))}var z,$=T({mixins:[w["a"],b["a"]],props:{className:null,lazyLoad:Boolean,asyncClose:Boolean,showIndicators:Boolean,images:{type:Array,default:function(){return[]}},loop:{type:Boolean,default:!0},swipeDuration:{type:Number,default:500},overlay:{type:Boolean,default:!0},showIndex:{type:Boolean,default:!0},startPosition:{type:Number,default:0},minZoom:{type:Number,default:1/3},maxZoom:{type:Number,default:3},overlayClass:{type:String,default:C("overlay")}},data:function(){return{scale:1,moveX:0,moveY:0,active:0,moving:!1,zooming:!1,doubleClickTimer:null}},computed:{imageStyle:function(){var e=this.scale,t={transitionDuration:this.zooming||this.moving?"0s":".3s"};return 1!==e&&(t.transform="scale3d("+e+", "+e+", 1) translate("+this.moveX/e+"px, "+this.moveY/e+"px)"),t}},watch:{value:function(){this.setActive(this.startPosition)},startPosition:function(e){this.setActive(e)}},methods:{onWrapperTouchStart:function(){this.touchStartTime=new Date},onWrapperTouchEnd:function(e){var t=this;Object(g["c"])(e);var i=new Date-this.touchStartTime,n=this.$refs.swipe||{},a=n.offsetX,s=void 0===a?0:a,o=n.offsetY,r=void 0===o?0:o;i<300&&s<10&&r<10&&(this.doubleClickTimer?(clearTimeout(this.doubleClickTimer),this.doubleClickTimer=null,this.toggleScale()):this.doubleClickTimer=setTimeout((function(){var e=t.active;t.$emit("close",{index:e,url:t.images[e]}),t.asyncClose||t.$emit("input",!1),t.doubleClickTimer=null}),300))},startMove:function(e){var t=e.currentTarget,i=t.getBoundingClientRect(),n=window.innerWidth,a=window.innerHeight;this.touchStart(e),this.moving=!0,this.startMoveX=this.moveX,this.startMoveY=this.moveY,this.maxMoveX=Math.max(0,(i.width-n)/2),this.maxMoveY=Math.max(0,(i.height-a)/2)},startZoom:function(e){this.moving=!1,this.zooming=!0,this.startScale=this.scale,this.startDistance=M(e.touches)},onImageTouchStart:function(e){var t=e.touches,i=this.$refs.swipe||{},n=i.offsetX,a=void 0===n?0:n;1===t.length&&1!==this.scale?this.startMove(e):2!==t.length||a||this.startZoom(e)},onImageTouchMove:function(e){var t=e.touches;if((this.moving||this.zooming)&&Object(g["c"])(e,!0),this.moving){this.touchMove(e);var i=this.deltaX+this.startMoveX,n=this.deltaY+this.startMoveY;this.moveX=Object(p["a"])(i,-this.maxMoveX,this.maxMoveX),this.moveY=Object(p["a"])(n,-this.maxMoveY,this.maxMoveY)}if(this.zooming&&2===t.length){var a=M(t),s=this.startScale*a/this.startDistance;this.scale=Object(p["a"])(s,this.minZoom,this.maxZoom)}},onImageTouchEnd:function(e){if(this.moving||this.zooming){var t=!0;this.moving&&this.startMoveX===this.moveX&&this.startMoveY===this.moveY&&(t=!1),e.touches.length||(this.moving=!1,this.zooming=!1,this.startMoveX=0,this.startMoveY=0,this.startScale=1,this.scale<1&&this.resetScale()),t&&Object(g["c"])(e,!0)}},setActive:function(e){this.resetScale(),e!==this.active&&(this.active=e,this.$emit("change",e))},resetScale:function(){this.scale=1,this.moveX=0,this.moveY=0},toggleScale:function(){var e=this.scale>1?1:2;this.scale=e,this.moveX=0,this.moveY=0},genIndex:function(){var e=this.$createElement;if(this.showIndex)return e("div",{class:C("index")},[this.slots("index")||this.active+1+" / "+this.images.length])},genCover:function(){var e=this.$createElement,t=this.slots("cover");if(t)return e("div",{class:C("cover")},[t])},genImages:function(){var e=this,t=this.$createElement,i={loading:function(){return t(y["a"],{attrs:{type:"spinner"}})}};return t(x["a"],{ref:"swipe",attrs:{loop:this.loop,indicatorColor:"white",duration:this.swipeDuration,initialSwipe:this.startPosition,showIndicators:this.showIndicators},class:C("swipe"),on:{change:this.setActive},nativeOn:{touchstart:this.onWrapperTouchStart,touchMove:g["c"],touchend:this.onWrapperTouchEnd,touchcancel:this.onWrapperTouchEnd}},[this.images.map((function(n,a){return t(S["a"],[t(m["a"],{attrs:{src:n,fit:"contain",lazyLoad:e.lazyLoad},class:C("image"),scopedSlots:i,style:a===e.active?e.imageStyle:null,nativeOn:{touchstart:e.onImageTouchStart,touchmove:e.onImageTouchMove,touchend:e.onImageTouchEnd,touchcancel:e.onImageTouchEnd}})])}))])}},render:function(){var e=arguments[0];if(this.value)return e("transition",{attrs:{name:"van-fade"}},[e("div",{class:[C(),this.className]},[this.genImages(),this.genIndex(),this.genCover()])])}}),A={loop:!0,images:[],value:!0,minZoom:1/3,maxZoom:3,className:"",onClose:null,onChange:null,lazyLoad:!1,showIndex:!0,asyncClose:!1,startPosition:0,swipeDuration:500,showIndicators:!1,closeOnPopstate:!1},P=function(){z=new(v["default"].extend($))({el:document.createElement("div")}),document.body.appendChild(z.$el),z.$on("change",(function(e){z.onChange&&z.onChange(e)}))},D=function(e,t){if(void 0===t&&(t=0),!o["d"]){z||P();var i=Array.isArray(e)?{images:e,startPosition:t}:e;return Object(n["a"])(z,A,i),z.$once("input",(function(e){z.value=e})),i.onClose&&z.$once("close",i.onClose),z}};D.install=function(){v["default"].use($)};var X=D,O=Object(a["a"])("uploader"),L=O[0],Y=O[1];t["a"]=L({inheritAttrs:!1,model:{prop:"fileList"},props:{disabled:Boolean,uploadText:String,afterRead:Function,beforeRead:Function,beforeDelete:Function,previewSize:[Number,String],name:{type:[Number,String],default:""},accept:{type:String,default:"image/*"},fileList:{type:Array,default:function(){return[]}},maxSize:{type:Number,default:Number.MAX_VALUE},maxCount:{type:Number,default:Number.MAX_VALUE},deletable:{type:Boolean,default:!0},previewImage:{type:Boolean,default:!0},previewFullImage:{type:Boolean,default:!0},imageFit:{type:String,default:"cover"},resultType:{type:String,default:"dataUrl"}},computed:{previewSizeWithUnit:function(){return Object(s["a"])(this.previewSize)}},methods:{getDetail:function(e){return void 0===e&&(e=this.fileList.length),{name:this.name,index:e}},onChange:function(e){var t=this,i=e.target.files;if(!this.disabled&&i.length){if(i=1===i.length?i[0]:[].slice.call(i),this.beforeRead){var n=this.beforeRead(i,this.getDetail());if(!n)return void this.resetInput();if(n.then)return void n.then((function(){t.readFile(i)})).catch(this.resetInput)}this.readFile(i)}},readFile:function(e){var t=this,i=c(e,this.maxSize);if(Array.isArray(e)){var n=this.maxCount-this.fileList.length;e.length>n&&(e=e.slice(0,n)),Promise.all(e.map((function(e){return l(e,t.resultType)}))).then((function(n){var a=e.map((function(e,t){var i={file:e};return n[t]&&(i.content=n[t]),i}));t.onAfterRead(a,i)}))}else l(e,this.resultType).then((function(n){var a={file:e};n&&(a.content=n),t.onAfterRead(a,i)}))},onAfterRead:function(e,t){t?this.$emit("oversize",e,this.getDetail()):(this.resetInput(),this.$emit("input",[].concat(this.fileList,r(e))),this.afterRead&&this.afterRead(e,this.getDetail()))},onDelete:function(e,t){var i=this;if(this.beforeDelete){var n=this.beforeDelete(e,this.getDetail(t));if(!n)return;if(n.then)return void n.then((function(){i.deleteFile(e,t)})).catch(o["e"])}this.deleteFile(e,t)},deleteFile:function(e,t){var i=this.fileList.slice(0);i.splice(t,1),this.$emit("input",i),this.$emit("delete",e,this.getDetail(t))},resetInput:function(){this.$refs.input&&(this.$refs.input.value="")},onPreviewImage:function(e){var t=this;if(this.previewFullImage){var i=this.fileList.filter((function(e){return f(e)})),n=i.map((function(e){return e.content||e.url}));this.imagePreview=X({images:n,closeOnPopstate:!0,startPosition:i.indexOf(e),onClose:function(){t.$emit("close-preview")}})}},closeImagePreview:function(){this.imagePreview&&this.imagePreview.close()},genPreviewItem:function(e,t){var i=this,n=this.$createElement,a=this.deletable&&n(d["a"],{attrs:{name:"clear"},class:Y("preview-delete"),on:{click:function(n){n.stopPropagation(),i.onDelete(e,t)}}}),s=f(e)?n(m["a"],{attrs:{fit:this.imageFit,src:e.content||e.url,width:this.previewSize,height:this.previewSize,radius:4},class:Y("preview-image"),on:{click:function(){i.onPreviewImage(e)}}}):n("div",{class:Y("file"),style:{width:this.previewSizeWithUnit,height:this.previewSizeWithUnit}},[n(d["a"],{class:Y("file-icon"),attrs:{name:"description"}}),n("div",{class:[Y("file-name"),"van-ellipsis"]},[e.file?e.file.name:e.url])]);return n("div",{class:Y("preview"),on:{click:function(){i.$emit("click-preview",e,i.getDetail(t))}}},[s,a])},genPreviewList:function(){if(this.previewImage)return this.fileList.map(this.genPreviewItem)},genUpload:function(){var e=this.$createElement;if(!(this.fileList.length>=this.maxCount)){var t,i=this.slots(),a=e("input",{attrs:Object(n["a"])({},this.$attrs,{type:"file",accept:this.accept,disabled:this.disabled}),ref:"input",class:Y("input"),on:{change:this.onChange}});if(i)return e("div",{class:Y("input-wrapper")},[i,a]);if(this.previewSize){var s=this.previewSizeWithUnit;t={width:s,height:s}}return e("div",{class:Y("upload"),style:t},[e(d["a"],{attrs:{name:"plus"},class:Y("upload-icon")}),this.uploadText&&e("span",{class:Y("upload-text")},[this.uploadText]),a])}}},render:function(){var e=arguments[0];return e("div",{class:Y()},[e("div",{class:Y("wrapper")},[this.genPreviewList(),this.genUpload()])])}})}}]);
//# sourceMappingURL=chunk-1364d535.25865436.js.map